module.exports = function($) {
	return this.define(function(public) {
		/* Public Properties
		-------------------------------*/
		// Default host to listen to
		public.host 	= '127.0.0.1';
		// Default port to use
		public.port 	= 1337;
		// Default http server
		public.server 	= null;
		// Default io handler
		public.io   	= null;
		// Default socket options
		public.options  = { serveClient : false };

		/* Private Properties
		-------------------------------*/
		var _http 	= require('http');
		var _io 	= require('socket.io')();
		var _events = new(require('events').EventEmitter);

		/* Loader
		-------------------------------*/
		public.__load = function() {
			return new this();
		};

		/* Construct
		-------------------------------*/
		/* Public Methods
		-------------------------------*/
		/**
		 * Connects socket io to the
		 * given server object or port
		 * number. First parameter can accept
		 * either http.server object or port
		 * number. And Second parameter will
		 * be the option for socket io
		 *
		 * @param 	object|number
		 * @param 	object
		 * @return 	object
		 */
		public.listen = function(http, options) {
			// If http.Server is defined
			// and options is defined
			if(http && options) {
				this.io = _io;
				this.io.attach(http, options);

				console.log('Socket IO listening to current server connection');
				return this.io;
			}

			// Create new http server for
			// socket io
			this.io = _server.call(this);

			return this.io;
		};

		/**
		 * Sets socket.io options
		 *
		 * @param 	object
		 * @return 	this
		 */
		public.setOptions = function(options) {
			this.options = options;
			return this;
		};

		/**
		 * Sets the HTTP Server Host
		 *
		 * @param 	string
		 * @return 	this
		 */
		public.setHost = function(host) {
			this.host = host;
			return this;
		};

		/**
		 * Sets the HTTP Server Port
		 *
		 * @param 	number
		 * @return 	this
		 */
		public.setPort = function(port) {
			this.port = port;
			return this;
		};

		/* Private Methods
		-------------------------------*/
		var _server = function() {
			// Get http server
			this.server = _http.Server();
			
			// Attach the server to socket io
			// and add socket io
			_io.attach(this.server, this.options);
			
			// Listen to the port and host being
			// set.
			this.server.listen(this.port, this.host);

			console.log('Socket IO listening on http://' + 
				this.host + ':' + this.port + '/');

			return _io;
		};
	});
};