/**
 * Chops - Client HTML5 on Push State
 *
 * @version 0.0.2
 * @author Christian Blanquera <cblanquera@openovate.com>
 * @website https://github.com/cblanquera/chops
 * @license MIT
 */
!function(){var t=function(){var t=jQuery;this.___construct=function(){this._hijackPushState(),this._hijackPopState(),this._hijackLinks(),this._hijackForms()},this.getState=function(){return window.history.state?window.history.state:i(window.location.href)},this.on=function(n,e){return t(window).on(n,e),this},this.once=function(n,e){return t(window).one(n,e),this},this.off=function(n,e){return e?(t(window).unbind(n,e),this):(t(window).unbind(n),this)},this.trigger=function(){return t(window).trigger.apply(t(window),arguments),this},this._hijackPushState=function(){var n=window.history.pushState;window.history.pushState=function(e,i,r){"function"==typeof window.history.onpushstate&&window.history.onpushstate({state:e});var o=n.apply(window.history,arguments),s=jQuery.Event("request");return s.state=e,t(window).trigger(s,[r,e]),o}},this._hijackPopState=function(){window.onpopstate=function(n){var e=jQuery.Event("request");e.state=n.state,t(window).trigger(e,[window.location.href,window.history.state])}},this._hijackLinks=function(){t(document).on("click","a",function(t){t.originalEvent.stop||0===this.href.indexOf(window.location.origin)&&(t.preventDefault(),r(this.href))})},this._hijackForms=function(){t(document.body).on("submit","form",function(n){t(this).attr("action")&&t(this).attr("action").length&&0!==t(this).attr("action").indexOf(window.location.origin)&&0!==t(this).attr("action").indexOf("/")||n.originalEvent.stop||(n.preventDefault(),o(this))})};var n=function(t){var n={};if(0==t.length)return{};for(var e,i,r,o,s,a,u=t.split("&"),c=0;c<u.length;c++){if(e=u[c].split("="),e[1]=e[1]||"",o=decodeURIComponent(e[0].replace(/\+/g,"%20")),s=decodeURIComponent(e[1].replace(/\+/g,"%20")),!e[1]){if(!e[0])continue;s=null}if("string"!=typeof s||!/^[\+\-]*[0-9\.]+$/.test(s)||/^0/.test(s)||s.indexOf(".")!==s.lastIndexOf(".")||isNaN(parseFloat(s))||-1==s.indexOf(".")?"string"!=typeof s||!/^[\+\-]*[0-9\.]+$/.test(s)||/^0/.test(s)||s.indexOf(".")!==s.lastIndexOf(".")||isNaN(parseFloat(s))||(s=parseInt(s)):s=parseFloat(s),-1!=o.indexOf("[")){for(i=o.split("["),current=n,a=0;a<i.length&&(o=i[a].replace("]",""),a+1!=i.length);a++)current[o]||(r={},("]"==i[a+1]||!isNaN(parseFloat(i[a+1].replace("]","")))&&isFinite(i[a+1].replace("]","")))&&(r=[]),current instanceof Array?current.push(r):current[o]=r),current=current instanceof Array?current[current.length-1]:current[o];current instanceof Array?current.push(s):current&&(current[o]=s)}else n[o]=s}return n},e=function(t,n){for(var i in t)t.hasOwnProperty(i)&&("string"==typeof t[i]&&0===t[i].indexOf("____CHOPS____")&&("undefined"==typeof n[t[i].substr(13)]&&delete t[i],t[i]=n[t[i].substr(13)]),"object"==typeof t[i]&&null!==t[i]&&e(t[i],n))},i=function(t){var e={url:t,query:"",json:"",method:"GET",data:{},serial:[],files:[]};-1!==e.url.indexOf("?")&&(e.query=e.url.split("?")[1]),0===e.url.indexOf(window.location.origin)&&(e.url=e.url.substr(window.location.origin.length)),e.data=n(e.query),e.json=JSON.stringify(e.data);var i=[];e.query.length&&(i=e.query.split("&"));for(var r,o=0;o<i.length;o++)r=i[o].split("="),e.serial.push({name:r.shift(),value:r.join("=")});return e},r=function(t){var n=i(t);window.history.pushState(n,"",t)},o=function(r){var o=t(r).attr("action")||window.location.href,s=i(o);s.method=t(r).attr("method")||"GET",s.method=s.method.toUpperCase(),s.query=t(r).serialize(),s.serial=t(r).serializeArray(),s.data=n(s.query),s.json=JSON.stringify(s.data),"GET"===s.method&&(-1!==s.url.indexOf("?")&&(s.url=s.url.split("?")[0]),s.url+="?"+s.query);var a={query:s.query,items:{}};t('input[type="file"]',r).each(function(){if(this.name&&this.name.length)for(var t=0,n=0;n<this.files.length;n++)s.files.push({name:this.name+"[]",value:this.files[n]}),a.items[++t]=this.files[n],a.query+="&"+this.name+"[]=____CHOPS____"+t}),a.data=n(a.query),e(a.data,a.items),s.data=a.data,window.history.pushState(s,"",s.url)}};"function"==typeof define?define(["jquery","classified"],function(n,e){return function(){return e(t)()}}):"function"==typeof jQuery&&"function"==typeof jQuery.extend?jQuery.extend({chops:function(){return this.classified(t)()}}):"object"==typeof window&&(window.chops=function(){return window.classified(t)()})}();